# ğŸŒ±DB 02

## âœ… Foreign Key

### Foreign Key

- ì™¸ë˜ í‚¤(ì™¸ë¶€ í‚¤)
- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í•œ í…Œì´ë¸”ì˜ í•„ë“œ ì¤‘ ë‹¤ë¥¸ í…Œì´ë¸”ì˜ í–‰ì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” í‚¤
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì†ì„±(í•„ë“œ)ì— í•´ë‹¹í•˜ê³ , ì´ëŠ” ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤(Primary Key)ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ëŠ” ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸” í–‰ 1ê°œì— ëŒ€ì‘ëœë‹¤.
  - ì´ ë•Œë¬¸ì— ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì—ì„œ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í–‰ì„ ì°¸ì¡°í•  ìˆ˜ ì—†ë‹¤.
- ì°¸ì¡°í•˜ëŠ” í…Œì´ë¸”ì˜ í–‰ ì—¬ëŸ¬ ê°œê°€ ì°¸ì¡°ë˜ëŠ” í…Œì´ë¸”ì˜ ë™ì¼í•œ í–‰ì„ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.



#### Foreign Keyì˜ ì˜ˆì‹œ

- í•˜ë‚˜ì˜ ê²Œì‹œê¸€ê³¼ ëŒ“ê¸€ê°„ì˜ ëª¨ë¸ ê´€ê³„(1:N ê´€ê³„)
  - **1:N ê´€ê³„**ì—ì„œ **ì™¸ë˜í‚¤ëŠ” Nì˜ ì—­í• ì„ í•˜ëŠ” ëª¨ë¸**ì´ ê°€ì§€ê²Œ ëœë‹¤.

#### Foreign Keyì˜ íŠ¹ì§•

- í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¶€ëª¨ í…Œì´ë¸”ì˜ ìœ ì¼í•œ ê°’ì„ ì°¸ì¡°(**ì°¸ì¡° ë¬´ê²°ì„±**)

- ì™¸ë˜ í‚¤ì˜ ê°’ì´ ë°˜ë“œì‹œ ë¶€ëª¨ í…Œì´ë¸”ì˜ **ê¸°ë³¸ í‚¤ì¼ í•„ìš”ëŠ” ì—†ì§€ë§Œ ìœ ì¼í•œ ê°’**ì´ì–´ì•¼ í•œë‹¤.
  - ë³´í†µ ë¶€ëª¨ í…Œì´ë¸”ì˜ pk(id)ê°€ ê¸°ë³¸ í‚¤ê°’ì˜ ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

#### [ì°¸ê³ ] ì°¸ì¡° ë¬´ê²°ì„±

- ë°ì´í„°ë² ì´ìŠ¤ ê´€ê³„ ëª¨ë¸ì—ì„œ ê´€ë ¨ëœ 2ê°œì˜ í…Œì´ë¸” ê°„ì˜ ì¼ê´€ì„±ì„ ë§í•œë‹¤.
- ì™¸ë˜ í‚¤ê°€ ì„ ì–¸ëœ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ ì†ì„±(ì—´)ì˜ ê°’ì€ ê·¸ í…Œì´ë¸”ì˜ ë¶€ëª¨ê°€ ë˜ëŠ” í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì¡´ì¬í•´ì•¼ í•œë‹¤

#### ForeignKey

- A many-to-one relationshop
- 2ê°œì˜ ìœ„ì¹˜ ì¸ìê°€ ë°˜ë“œì‹œ **í•„ìš”**
  1. **ì°¸ì¡°í•˜ëŠ” model class**
  2. **on_delete ì˜µì…˜**
- migrate ì‘ì—… ì‹œ ì™¸ë˜í‚¤ í•„ë“œ ì´ë¦„ì— _idë¥¼ ì¶”ê°€í•˜ì—¬ ë°ì´í„°ë² ì´ìŠ¤ ì—´ ì´ë¦„ì„ ë§Œë“ ë‹¤.
  - ì‹œí—˜ë¬¸ì œ ) 'Comment ëª¨ë¸ì€ ì™¸ë˜í‚¤ article_idë¥¼ í¬í•¨í•©ë‹ˆë‹¤.' ë¼ê³  ì í˜€ìˆë‹¤ë©´ ì™¸ë˜í‚¤ í•„ë“œëª…ì€ articleì´ë‹¤.

#### comment ëª¨ë¸ ì •ì˜í•˜ê¸°

``` python
# articles/models.py
# ëŒ“ê¸€ì€ articles ì•±ì—ì„œ êµ¬í˜„í•œë‹¤.(ê²Œì‹œíŒ ìš”ì†Œ)

class Comment(models.Model):# Comment ëª¨ë¸(ëª¨ë¸ í´ë˜ìŠ¤)ì€ ë‹¤ìŒê³¼ ê°™ì€ í•„ë“œë“¤ì„ ê°€ì§„ë‹¤.
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    # ì™¸ë˜í‚¤ì™€ ê´€ë ¨ëœ ë³€ìˆ˜ëŠ”, 1:Nê´€ê³„ì—ì„œ ì°¸ì¡°ë˜ëŠ” ëª¨ë¸ì˜ ë‹¨ìˆ˜í˜• ì†Œë¬¸ìë¡œ ì‘ì„±í•œë‹¤.(M:Nê´€ê³„ì—ì„œëŠ” ë³µìˆ˜í˜•ìœ¼ë¡œ ì‘ì„±í•œë‹¤.)
    # ì™¸ë˜í‚¤ í•„ë“œ, ForeignKeyí•„ë“œë¥¼ ì‚¬ìš©í•œë‹¤.(Fieldê°€ ë¶™ì§€ ì•ŠìŒì— ìœ ì˜í•œë‹¤.)
    # ë‘ê°œì˜ ì¸ìë¥¼ ì‚¬ìš©í•œë‹¤. ì°¸ì¡°í•˜ëŠ” ëª¨ë¸ê³¼ on_delete
    content = models.CharField(max_length=200)
    # ëŒ“ê¸€ì˜ ë‚´ìš©
    created_at = models.DateTimeField(auto_now_add=True)
    # ìƒì„±ì¼
    updated_at = models.DateTimeField(auto_now=True)
    # ìˆ˜ì •ì¼
    
    def __str__(self):
        return self.content
    # ê°ì²´ í‘œí˜„ë°©ì‹
```



#### ForeignKey arguments - 'on_delete'

- ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ê°ì²´ê°€ ì‚¬ë¼ì¡Œì„ ë•Œ ì™¸ë˜ í‚¤ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•  ì§€ë¥¼ ì •ì˜í•œë‹¤.
- Database Integrity(ë°ì´í„° ë¬´ê²°ì„±)ì„ ìœ„í•´ì„œ ë§¤ìš° ì¤‘ìš”í•œ ì„¤ì •
- on_delete ì˜µì…˜ì— ì‚¬ìš©ê°€ëŠ¥í•œ ê°’ë“¤
  - CASECADE : ë¶€ëª¨ ê°ì²´(ì°¸ì¡° ëœ ê°ì²´)ê°€ ì‚­ì œ ëì„ ë•Œ ì´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´ë„ ì‚­ì œ
  - PROTECT, SET_NULL, SET_DEFAULT, SET(), DO_NOTHING, RESTRICT

#### [ì°¸ê³ ] ë°ì´í„° ë¬´ê²°ì„±

- ë°ì´í„°ì˜ ì •í™•ì„±ê³¼ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê³  ë³´ì¦í•˜ëŠ” ê²ƒì„ ê°€ë¦¬í‚¤ë©°, ë°ì´í„°ë² ì´ìŠ¤ë‚˜ RDBMS ì‹œìŠ¤í…œì˜ ì¤‘ìš”í•œ ê¸°ëŠ¥

- ë¬´ê²°ì„± ì œí•œì˜ ìœ í˜•
  1. ê°œì²´ ë¬´ê²°ì„±(Entity integrity)
     - PKì˜ ê°œë…ê³¼ ê´€ë ¨
     - ëª¨ë“  í…Œì´ë¸”ì´ PKë¥¼ ê°€ì ¸ì•¼ í•˜ë©° PKë¡œ ì„ íƒëœ ì—´ì€ ê³ ìœ í•œ ê°’ì´ì–´ì•¼ í•˜ê³  ë¹ˆ ê°’ì€ í—ˆìš©ì¹˜ ì•ŠìŒì„ ê·œì •
  2. ì°¸ì¡° ë¬´ê²°ì„±(Referential integrity)
     - FK(ì™¸ë˜ í‚¤) ê°œë…ê³¼ ê´€ë ¨
     - FK ê°’ì´ ë°ì´í„° ë² ì´ìŠ¤ì˜ íŠ¹ì • í…Œì´ë¸”ì˜ PK ê°’ì„ ì°¸ì¡°í•˜ëŠ” ê²ƒ
  3. ë²”ìœ„(ë„ë©”ì¸) ë¬´ê²°ì„±(Domain  integrity)
     - ì •ì˜ëœ í˜•ì‹(ë²”ìœ„)ì—ì„œ ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ì˜ ëª¨ë“  ì»¬ëŸ¼ì´ ì„ ì–¸ë˜ë„ë¡ ê·œì •

#### ë°ì´í„°ë² ì´ìŠ¤ì˜ ForeignKey í‘œí˜„

- ë§Œì•½ ForeignKey ì¸ìŠ¤í„´ìŠ¤ë¥¼ abcdë¡œ ìƒì„±í–ˆë‹¤ë©´ abcd_idë¡œ ë§Œë“¤ì–´ì§„ë‹¤
- í•˜ì§€ë§Œ ëª…ì‹œì ì¸ ëª¨ë¸ê´€ê³„ íŒŒì•…ì„ ìœ„í•´ ì°¸ì¡°í•˜ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì˜ ì†Œë¬¸ì(ë‹¨ìˆ˜í˜•)ìœ¼ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ë°”ëì§í•˜ë‹¤.(1: N)

#### ëŒ“ê¸€ ìƒì„±í•˜ê¸°

1. ``` bash
   $python manage.py shell_plus
   ```

2. ``` bash
   comment = Comment()
   # Comment í´ë˜ìŠ¤ë¥¼ í†µí•´ commentë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ ìƒì„±, 
   ```

3. ``` bash
   comment.content = 'First comment'
   comment.save()
   # NOT NULL cONSTARINT Failed(ì™¸ë˜í‚¤ ê°’ì´ ë¹„ì–´ìˆìŒ)
   ```

4. ``` bash
   # ê²Œì‹œê¸€ ë¨¼ì € ë¹ ë¥´ê²Œ ìƒì„±
   article = Article.objects.create(title='title', content='content')
   ```

   - comment.article_id ì™€ ê°™ì´ ì½• ì°ì„ ê²½ìš°, aomment.article_id = article.pkë¡œ ì‘ì„±í•˜ì—¬ì•¼ í•œë‹¤.
   - comment.article = articleë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

5. ``` bash
   comment.article = article
   ```

6. ``` bash
   comment.save()
   ```

7. ```bash
   comment.pk
   ```

8. ``` bash
   comment.article.content
   # ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³  ìˆëŠ” ì…ì¥ì—ì„œëŠ” ì°¸ì¡°ê°€ ì•„ì£¼ ê°„ë‹¨í•˜ê²Œ ëœë‹¤.
   ```



#### admin siteì—ì„œ ì‘ì„±ëœ ëŒ“ê¸€ í™•ì¸

``` python
# articles/admin.py

from .models import Article, Comment

admin.stie.register(Comment)
```

``` bash
$python manage.py createsuperuser
```



#### 1:N ê´€ê³„ related manager

- ì—­ì°¸ì¡°('comment_set')
  - Article(1) - > Comment(N)
  - article.comment í˜•íƒœë¡œëŠ” ì‚¬ìš©í•  ìˆ˜  ì—†ê³ , article.comment_set managerê°€ ìƒì„±ëœë‹¤.
    - ëŒ“ê¸€ì„ ì¶œë ¥í•  ìˆ˜  ìˆë‹¤.
  - ê²Œì‹œê¸€ì— ëª‡ ê°œì˜ ëŒ“ê¸€ì´ ì‘ì„± ë˜ì—ˆëŠ”ì§€ Django ORMì´ ë³´ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.
    - articleì€ commentê°€ ìˆì„ ìˆ˜ë„, ì—†ì„ ìˆ˜ë„ ìˆë‹¤.
    - ì‹¤ì œë¡œ Article í´ë˜ìŠ¤ì—ëŠ” Comment ì™€ì˜ ì–´ë– í•œ ê´€ê³„ë„ ì‘ì„±ë˜ì–´ ìˆì§€ ì•Šë‹¤.
- ì°¸ì¡°('article')
  - Comment(N) -> article(1)
  - ëŒ“ê¸€ì˜ ê²½ìš° ì–´ë– í•œ ëŒ“ê¸€ì´ë“  ë°˜ë“œì‹œ ìì‹ ì´ ì°¸ì¡°í•˜ê³  ìˆëŠ” ê²Œì‹œë¬¼ì´ ìˆìœ¼ë¯€ë¡œ, comment.articleê³¼ ê°™ì´ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
  - ì‹¤ì œ ForeignKey ë˜í•œ Comment í´ë˜ìŠ¤ì—ì„œ ì‘ì„±ëœë‹¤.

#### ForeignKey arguments - 'related_name'

- ì—­ ì°¸ì¡°ì‹œ ì‚¬ìš©í•  ì´ë¦„('model_set' manager)ì„ ë³€ê²½í•  ìˆ˜ ìˆëŠ” ì˜µì…˜

  ``` python
  # articles/models.py
  
  class Comment(models.Model):
      article= models.ForeignKey(Article, on_delete=models.CASCADE, related_name='contents')
  ```

- ìœ„ì™€ ê°™ì´ ë³€ê²½í•˜ë©´ article.comment_setì€ ë”ì´ìƒ ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , article.commentsë¡œ ëŒ€ì²´ëœë‹¤.

  - article.comment_set.all() -> article.comments.all()

- [ì£¼ì˜] ì—­ì°¸ì¡° ì‹œ ì‚¬ìš©í•  ì´ë¦„ ìˆ˜ì • í›„, migration ê³¼ì •ì´ í•„ìš”í•˜ë‹¤.

- [ì£¼ì˜] 1:Nì—ì„œ êµ³ì´ ëª…ì¹­ì„ ë°”ê¾¸ì§€ ì•ŠëŠ”ë‹¤. (comments_set ê·¸ëƒ¥ ì‚¬ìš©í•˜ë„ë¡ í•˜ì.)





### Comment CREATE

### Comment READ

### Comment DELETE



## âœ… Customizing authentication in Django

### Substituting a custom User model

### Custom user & Built-in auth forms



